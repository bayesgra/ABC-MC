# ===============================
# Semi-Automatic ABC for Model Selection
# ===============================
library(abctools)
library(reticulate)
set.seed(1234)
# ================================================================
# Define input/output folders
# ================================================================
data_dir <- "data"
results_dir <- "results"
saABC_dir <- file.path(results_dir, "saABC")
if (!dir.exists(results_dir)) dir.create(results_dir, recursive = TRUE)
if (!dir.exists(saABC_dir)) dir.create(saABC_dir, recursive = TRUE)
# ================================================================
# Load observed datasets from .npz file
# ================================================================
np <- import("numpy")
observed <- np$load(file.path(data_dir, "observed_datasets.npz"), allow_pickle = TRUE)
observed_datasets <- observed$f[["observed_datasets"]]  # Adjust key name if needed
dim(observed_datasets)  # Should print (100, 100)
dim(observed_datasets)
sim_ss <- read.csv("data/toad_simulated_stats.csv", header = TRUE)
# -----------------------------
# Load simulation summaries/params (if you use them)
#   Adjust paths/columns to your setup
# -----------------------------
sim_ss <- read.csv("data/toad_simulated_stats.csv", header = TRUE)
theta  <- read.csv("data/toad_simulated_param.csv", header = TRUE)
if (!"d0" %in% names(theta)) theta$d0 <- NA_real_
theta$d0 <- ifelse(is.na(theta$d0), 0, theta$d0)
stopifnot(nrow(sim_ss) == nrow(theta))
tot <- cbind(sim_ss, theta)
tot <- stats::na.omit(tot)
sim_ss <- tot[, seq_len(ncol(sim_ss)), drop = FALSE]
theta  <- tot[, (ncol(sim_ss) + 1):ncol(tot), drop = FALSE]
dim(sim_ss)
